{% extends "layout.html" %}
{% block body %}
<div class="row">
  <div class="col-lg-12">
    {% for notification in notifications %}
      <div class="alert alert-info">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">&times;</button>
        {{ notification.message }}
      </div>
    {% endfor %}
  </div>
</div>
<div class="row">
  <div class="col-lg-12">
    <div class="page-header">
      <h2>{{ title }}</h2>
    </div>
  </div>
</div>
<div id="search">
  <div class="row">
    <div class="col-lg-12">
      <form class="form-horizontal" method="POST" action="/search">
        <div class="input-group">
          <input v-model="query" type="search" class="form-control" name="query" autocomplete="off" placeholder="Search â€¦">
          <span class="input-group-btn">
            <button class="btn btn-default" type="submit"><i class="fa fa-search" aria-hidden="true"></i></button>
          </span>
        </div>
      </form>
    </div>
  </div>
  <div class="row dataset-pad" v-for="item in items">
    <div class="col-sm-1">
      <img class="img-responsive" src="https://placeholdit.imgix.net/~text?txtsize=33&txt=%C3%97&w=64&h=64"/>
    </div>
    <div class="col-sm-11">
      <h3 class="dataset-link">
        {% raw %}
        <a v-bind:href="item.owner_url">{{ item.owner }}</a> /
        <a v-bind:href="item.collection_url">{{ item.collection }}</a> /
        <a v-bind:href="item.url">{{ item.name }}</a>
        {% endraw %}
      </h3>
      <p></p>
    </div>
  </div>
</div>
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/vue.resource/1.0.3/vue-resource.min.js"></script>
<script src="https://unpkg.com/lodash@4.13.1/lodash.min.js"></script>
<script>
  var app = new Vue({
    el: '#search',
    data: {
      query: '',
      message: '',
      items: []
    },
    watch: {
      query: function (data) {
        this.searchQuery (data)
      }
    },
    methods: {
      searchQuery: _.debounce(
        function (query) {
          var params = {
            q: query,
            token: '{{ current_user.token }}'
          }

          this.$http.get('/api/search', {params: params}).then((response) => {
            return response.json();
          }).then((items) => {
            this.items = items
          });
        },
        250
      )
    }
  })
</script>
{% endblock %}
