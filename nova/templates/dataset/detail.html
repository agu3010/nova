{% set page_title = 'Dataset ' + dataset.name %}
{% extends "layout.html" %}
{% macro dataset_link(label, path=None, ext=None) -%}
  {% if ext %}
  <a href="{{ url_for("show_dataset", name=current_user.name, collection_name=dataset.collection.name, dataset_name=dataset.name, path=path) }}{{ ext }}">{{ label }}</a>
  {% else %}
  <a href="{{ url_for("show_dataset", name=current_user.name, collection_name=dataset.collection.name, dataset_name=dataset.name, path=path) }}">{{ label }}</a>
  {% endif %}
{%- endmacro %}
{% macro dataset_row(collection, dataset) -%}
<div class="row dataset-pad">
  <div class="col-lg-1">
    {% if dataset.has_thumbnail %}
    <img class="img-responsive" width="64" height="64" src="{{ url_for("show_dataset", name=collection.user.name, collection_name=collection.name, dataset_name=dataset.name, path='.thumb.jpg') }}"/>
    {% else %}
    <img class="img-responsive" src="https://placeholdit.imgix.net/~text?txtsize=33&txt=%C3%97&w=64&h=64"/>
    {% endif %}
  </div>
  <div class="col-lg-11">
    <h3 class="dataset-link">
      <a href="{{ url_for("show_dataset", name=collection.user.name, collection_name=collection.name, dataset_name=dataset.name) }}">{{ dataset.name }}</a>
    </h3>
    <p>
    {% if dataset.description %}
      {{ dataset.description }}
    {% endif %}
    </p>
  </div>
</div>
{%- endmacro %}
{% block body %}
<div class="row">
  <div class="col-lg-12">
    <div class="page-header">
{% if dataset.type == "samplescan" %}
      <h2>Sample scan</h2>
{% elif dataset.type == "volume" %}
      <h2>Volume</h2>
{% else %}
      <h2>Information</h2>
{% endif %}
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-3">
    {% if dataset.has_thumbnail %}
    <img class="img-responsive" width="128" height="128" src="{{ url_for("show_dataset", name=collection.user.name, collection_name=collection.name, dataset_name=dataset.name, path='.thumb.jpg') }}"/>
    {% else %}
    <img class="img-responsive" src="https://placeholdit.imgix.net/~text?txtsize=33&txt=%C3%97&w=128&h=128"/>
    {% endif %}
  </div>
  <div class="col-md-3">
    {% if dataset.type == "samplescan" %}
    <p>Genus: <a href="{{ url_for("search", genus=dataset.genus.id) }}">{{ dataset.genus.name}}</a></p>
  </div>
  <div class="col-md-3">
    <p>Family: <a href="{{ url_for("search", family=dataset.family.id) }}">{{ dataset.family.name}}</a></p>
  </div>
  <div class="col-md-3">
    <p>Order: <a href="{{ url_for("search", order=dataset.order.id) }}">{{ dataset.order.name}}</a></p>
    {% endif %}
  </div>
</div>
{% if parents %}
<div class="row">
  <div class="col-lg-12">
    <h3>Parent dataset</h3>
  </div>
</div>
{{ dataset_row(collection, parents[0]) }}
{% endif %}
{% if children %}
<div class="row">
  <div class="col-lg-12">
    <h3>Derived datasets</h3>
  </div>
</div>
{% for dataset in children %}
  {{ dataset_row(collection, dataset) }}
{% endfor %}
{% endif %}
{% if dataset.type == "samplescan" %}
<div class="row">
  <div class="col-lg-12">
    <div class="page-header">
      <h2>Reconstruct</h2>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-lg-12">
    <form class="form-inline" method="POST" action="{{ url_for("process", dataset_id=dataset.id) }}">
      <div class="form-group">
        <input class="form-control" name="name" placeholder="Dataset">
      </div>
      <div class="form-group">
        <input class="form-control" name="darks" placeholder="Darks">
      </div>
      <div class="form-group">
        <input class="form-control" name="flats" placeholder="Flats">
      </div>
      <div class="form-group">
        <input class="form-control" name="projections" placeholder="Projections">
      </div>
      <div class="form-group">
        <input class="form-control" name="outname" placeholder="Output">
      </div>
      <button type="submit" class="btn btn-default">Reconstruct</button>
    </form>
  </div>
</div>
{% endif %}
{% if origin %}
<div class="row">
  <div class="col-lg-12">
    <div class="page-header">
      <h2>Related</h2>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-lg-12">
    <p>
    {% for p in origin %}
    <a class="btn btn-link" href="/detail/{{ p.id }}">{{ p.name }}</a> <i class="fa fa-angle-right"></i>
    {% endfor %}
    <a class="btn btn-link active" href="#">{{ dataset.name }}</a>
    </p>
  </div>
</div>
{% endif %}
{% if list_files %}
<div class="row">
  <div class="col-lg-12">
    <div class="page-header">
      <h2>Files</h2>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-lg-12">
    <ol class="breadcrumb">
      <li>{{ dataset_link("root") }}</li>
      {% for part, path in subpaths %}
      <li>{{ dataset_link(part, path) }}</li>
      {% endfor %}
    </ol>
  </div>
</div>
<div class="row">
  <div class="col-lg-12">
    <table class="table table-hover">
    {% for dirname in dirs %}
    <tr>
      <td>{{ dataset_link(dirname, path, dirname) }}</td>
      <td></td>
    </tr>
    {% endfor %}
    {% for filename, filesize in files %}
    <tr>
      <td>{{ filename }}</td>
      <td>{{ filesize | naturalsize }}</td>
    </tr>
    {% endfor %}
    </table>
  </div>
</div>
{% endif %}
{% endblock %}

